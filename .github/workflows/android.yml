name: Android CI - Build APK  
  
on:  
  push:  
    branches: [ main, master, dev ]  
  pull_request:  
    branches: [ main, master, dev ]  
  workflow_dispatch:  
  
jobs:  
  build:  
    runs-on: ubuntu-latest  
      
    steps:  
    - name: 检出代码  
      uses: actions/checkout@v4  
        
    - name: 设置 JDK 17  
      uses: actions/setup-java@v4  
      with:  
        java-version: '17'  
        distribution: 'temurin'  
        cache: gradle  
      
    - name: 生成 Debug 签名密钥  
      run: |  
        keytool -genkey -v -keystore debug.keystore -storepass android -alias androiddebugkey -keypass android -keyalg RSA -keysize 2048 -validity 10000 -dname "CN=Android Debug,O=Android,C=US"  
          
    - name: 授予 gradlew 执行权限  
      run: chmod +x gradlew  
        
    - name: 构建并签名 Debug APK  
      run: ./gradlew assembleDebug  
      env:  
        SIGNING_KEYSTORE_PATH: ${{ github.workspace }}/debug.keystore  
        SIGNING_KEYSTORE_PASSWORD: android  
        SIGNING_KEY_ALIAS: androiddebugkey  
        SIGNING_KEY_PASSWORD: android  
        
    - name: 构建 Release APK  
      run: ./gradlew assembleRelease  
        
    - name: 上传 Debug APK  
      uses: actions/upload-artifact@v4  
      with:  
        name: fcmfix-debug-signed  
        path: app/build/outputs/apk/debug/*.apk  
        retention-days: 30  
          
    - name: 上传 Release APK  
      uses: actions/upload-artifact@v4  
      with:  
        name: fcmfix-release  
        path: app/build/outputs/apk/release/*.apk  
        retention-days: 30
